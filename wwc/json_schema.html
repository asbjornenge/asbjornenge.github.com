<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Web, Words & Coffee</title>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

        <link rel="stylesheet" href="/css/reset.css">
        <link rel="stylesheet" href="/css/fonts.css">
        <link rel="stylesheet" href="/css/asbjornenge.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link href='http://fonts.googleapis.com/css?family=Elsie' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Bilbo+Swash+Caps' rel='stylesheet' type='text/css'>
        <script src="/js/lib/ga.js"></script>
        <script src="/js/lib/jquery-1.9.0.min.js"></script>
        <script src="/js/lib/tap.js"></script>
        <script src="/js/init.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="head">
            <a link="/" class="nav_item">
                <img id="logo" src="/img/avatar_asbjornenge.jpeg"/>
            </a>
            <div id="label">Web, Words & Coffee</div>
            <ul id="menu">
                <li class="about nav_item" link="/about.html">About</li>
                <li class="separator">:</li>
                <!--
                <li class="crly nav_item" link="/crly.html">Crly</li>
                <li class="separator">:</li>
                -->
                <li class="software nav_item" link="/software.html">Software</li>
                <li class="separator">:</li>
                <li class="blog nav_item" link="/">Blog</li>
            </ul>
            <span class="nav_selector">&nbsp;</span>
        </div>
        <div style="clear:both"></div>
        <div id="content">
            <h1>JSON Schema Validation</h1>

<p>Your probably talking JSON with a RESTful api, right?<br>
If you care about creating a great experience, you need to take error handling seriously. Handling timeouts and http error codes is pretty straight forward, but handling corrupt data can be tricky. It often leaves an ugly footprint in your code. Lot&#39;s of <strong>if</strong>&#39;s and <strong>hasOwnProperty</strong>&#39;s. Instead, using <a href="http://json-schema.org">json-schema</a>, you can validate your JSON data first and be sure it is as expected.</p>

<h2>JSON-Schema</h2>

<blockquote>
<p>A JSON Media Type for Describing the Structure and Meaning of JSON Documents</p>
</blockquote>

<p>Example; If you have some JSON Data:</p>

<pre><code>{
    &quot;title&quot; : &quot;Kapsokisio&quot;
}
</code></pre>

<p>You can define a corresponding JSON Schema:</p>

<pre><code>{
    &quot;type&quot; : &quot;object&quot;,
    &quot;required&quot; : [&quot;title&quot;]
    &quot;properties&quot; : {
        &quot;title&quot; : { &quot;type&quot; : &quot;string&quot; } 
    }
}
</code></pre>

<p>You can validate your data using that schema. If it is valid, you can be sure this data is an object with a title property of type string.</p>

<h3>Specification</h3>

<p>The latest <a href="http://www.ieft.org">IETF</a> draft is currently <a href="http://tools.ietf.org/html/draft-zyp-json-schema-03">v3</a>, but they have a v4 &quot;<em>â€¦being prepared for submission in early 2013</em>&quot;. <strong>This post will focus on v4</strong>.</p>

<h3>Software</h3>

<p>There is a variety of <a href="http://json-schema.org/implementations.html">implementations</a> available. Since I choose to focus on v4 and since I&#39;m a webnerd, <strong>I&#39;ll be using the <a href="https://github.com/geraintluff/tv4">tv4</a> validator for the examples</strong>.</p>

<h2>Usage</h2>

<p><strong>NB!</strong> This article is in no way a usage reference!!<br>
It&#39;s more a collection of the things I stubled across trying to figure out how this JSON-Schema thing works. Some important bits, and some of the things I found really useful. See the <a href="#further">further reading</a> section for more possibilites and options.</p>

<h3><em>type</em></h3>

<p>Using &quot;type&quot; you can specify the datatype required for the current object. The value can be a string or an array. Available values are; <strong>object, array, string, boolean, integer, number, null</strong>. The following requires the data to be either an object or a string.</p>

<pre><code>{
    &quot;type&quot; : [&quot;object&quot;,&quot;string&quot;]
}

tv4.validate({}, schema) =&gt; true
tv4.validate([], schema) =&gt; false
</code></pre>

<h3><em>enum</em></h3>

<p>Using &quot;enum&quot; you can define an array with elements of any type. Data must be equal to one of the elements to validate.</p>

<pre><code>{
    &quot;enum&quot; : [[1,true,0], {}, 28, &quot;Burbon&quot;]
}

tv4.validate([1,true,0], schema) =&gt; true
tv4.validate(34, schema) =&gt; false
</code></pre>

<h3><em>required</em></h3>

<p>Using &quot;required&quot; you can define an array of required properties. It&#39;s value is an array of strings.</p>

<pre><code>{
    &quot;required&quot; : [&quot;title&quot;,&quot;origin&quot;]
}

tv4.validate({&quot;title&quot; : &quot;&quot;, &quot;origin&quot; : &quot;&quot;}, schema) =&gt; true
tv4.validate({&quot;title&quot; : &quot;&quot;}, schema) =&gt; false
</code></pre>

<h3><em>properties</em></h3>

<p>Using &quot;properties&quot; you can further specify an objects properties. It is an object where each value is a separate schema.</p>

<pre><code>{
    &quot;properties&quot; : {
        &quot;title&quot;   : { &quot;type&quot; : &quot;string&quot; },
        &quot;weight&quot;  : { &quot;type&quot; : &quot;number&quot; }
    }
}

tv4.validate({&quot;title&quot; : &quot;&quot;, &quot;weight&quot; : 2}, schema) =&gt; true
tv4.validate({&quot;title&quot; : &quot;&quot;, &quot;weight&quot; : &quot;2&quot;}, schema) =&gt; false
</code></pre>

<h3><em>items</em></h3>

<p>Using &quot;items&quot; you can specify the requirements for the items in an array. It can be a single schema or an array of schemas. The following requires the elements in this array to be a string or an object.</p>

<pre><code>{
    items : [
        { &quot;type&quot; : &quot;string&quot; },
        { &quot;type&quot; : &quot;object&quot; }
    ]
}

tv4.validate([&quot;&quot;,{}], schema) =&gt; true
tv4.validate([&quot;&quot;,true], schema) =&gt; false
</code></pre>

<h3><em>pattern</em></h3>

<p>Using &quot;pattern&quot; you can validate using regular expressions. Powerful stuff!</p>

<pre><code>{
    &quot;properties&quot; : {
        &quot;url&quot; : { &quot;type&quot; : &quot;string&quot;, &quot;pattern&quot; : /(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;amp;:\/~+#-]*[\w@?^=%&amp;amp;\/~+#-])?/ }
    }
}

tv4.validate({&quot;url&quot; : &quot;http://google.com&quot;}, schema) =&gt; true
tv4.validate({&quot;url&quot; : &quot;htt:/googleco.m&quot;}, schema) =&gt; false
</code></pre>

<h3><em>$ref</em></h3>

<p>This is a way of referencing other schemas. It requires a URI or an # for self referencing. Using &quot;definitions&quot; as a location for your &quot;local&quot; referenced schemas is not a requirement, it is simply a common practice.</p>

<pre><code>{
    &quot;items&quot; : { 
        &quot;$ref&quot; : &quot;#/definitions/bean&quot;
    },
    &quot;definitions&quot; : {
        &quot;bean&quot; : {
            &quot;type&quot; : &quot;object&quot;,
            &quot;required&quot; : [&quot;origin&quot;],
            &quot;properties&quot; : {
                &quot;origin&quot; : { &quot;enum&quot; : [&quot;kenya&quot;,&quot;rawanda&quot;] }
            }
        }
    }
}

tv4.validate([{&quot;origing&quot; : &quot;kenya&quot;}], schema) =&gt; true
tv4.validate([{&quot;origing&quot; : &quot;brazil&quot;}], schema) =&gt; false
tv4.validate([&quot;kenya&quot;,&quot;rawanda&quot;], schema) =&gt; false
</code></pre>

<h3><em>allOf</em></h3>

<p>Using &quot;allOf&quot; you can define an array of schemas where your data elements must validate against all of them.</p>

<pre><code>{
    &quot;allOf&quot; : [
        { &quot;type&quot; : &quot;integer&quot; },
        { &quot;minumum&quot; : 6 }
    ]
}

tv4.validate(6, schema) =&gt; true
tv4.validate(5, schema) =&gt; false
</code></pre>

<h3><em>oneOf</em></h3>

<p>Using &quot;oneOf&quot; you can define an array of schemas where your data elements must validate against one (and only one) of them.</p>

<pre><code>{
    &quot;oneOf&quot; : [
        { &quot;type&quot;    : &quot;integer&quot; },
        { &quot;minimum&quot; : 6 }
    ]
}

tv4.validate(5, schema) =&gt; true
tv4.validate(6, schema) =&gt; false
</code></pre>

<h3><em>anyOf</em></h3>

<p>Using &quot;anyOf&quot; you can define an array of schemas where your data elements can validate against any (at least one) of them.</p>

<pre><code>{
    &quot;anyOf&quot; : [
        { &quot;type&quot; : &quot;string&quot;  },
        { &quot;type&quot; : &quot;integer&quot; }
    ]
}

tv4.validate(&quot;&quot;, schema) =&gt; true
tv4.validate(4, schema) =&gt; true
tv4.validate(true, schema) =&gt; false
</code></pre>

<h3><em>not</em></h3>

<p>Using &quot;not&quot; you can define a schema your data elements should to not validate against.</p>

<pre><code>{
    &quot;not&quot; : { &quot;type&quot; : &quot;string&quot; }
}

tv4.validate(1, schema) =&gt; true
tv4.validate(&quot;test&quot;, schema) =&gt; false
</code></pre>

<h3>Error handling (tv4 specific)</h3>

<p>I just thought I&#39;d quickly mention how tv4 handles failure:</p>

<pre><code>tv4.validate([],{&quot;type&quot; : &quot;object&quot;})
var err = tv4.error
console.log(err.dataPath, err.schemaPath, err.message)
$.each(err.subError, function(i,err) {
    console.log(err.dataPath, err.schemaPath, err.message)
})
</code></pre>

<h2><a id="further"></a>Furter reading</h2>

<p>I would really recommend reading through the <a href="https://github.com/geraintluff/tv4/tree/master/tests/tests">tests for tv4</a>, they provide excellent example of the different possibilites.<br>
The JSON-Schema <a href="http://json-schema.org/">website</a> also have lots of info and some great <a href="http://json-schema.org/example2.html">examples</a>. And of course the <a href="http://json-schema.org/documentation.html">documentation</a>.</p>

<h2>Pros</h2>

<ul>
<li>Cleaner code</li>
<li>Better maintainability</li>
<li>Better apps</li>
</ul>

<h2>Cons</h2>

<p>It can be quite tideous building a good schema describing your data. And of course, if you change your data structures, you need to update your schema (in addition to your code). But considering how this approach will simplify your codebase, I would definately say it&#39;s well worth it.</p>

<h2>Complex example</h2>

<pre><code>{
    &quot;title&quot;   : &quot;Kapsokisio&quot;,
    &quot;origin&quot;  : &quot;Kenya&quot;,
    &quot;variety&quot; : [SL28,SL34],
    &quot;process&quot; : WASHED,
    &quot;weight&quot;  : { 
        &quot;amount&quot; : 350, 
        &quot;unit&quot;   : &quot;g&quot;Â 
    },
    &quot;roast&quot;   : &quot;light&quot;,
    &quot;roasted&quot; : &lt;date&gt;
}
</code></pre>

            <div class="push"></div>
        </div>
        <div id="footer">enjoy.</div>
    </body>
</html>
