<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Web, Words & Coffee</title>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

        <link rel="stylesheet" href="/css/reset.css">
        <link rel="stylesheet" href="/css/fonts.css">
        <link rel="stylesheet" href="/css/asbjornenge.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link href='http://fonts.googleapis.com/css?family=Elsie' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Bilbo+Swash+Caps' rel='stylesheet' type='text/css'>
        <script src="/js/lib/ga.js"></script>
        <script src="/js/lib/jquery-1.9.0.min.js"></script>
        <script src="/js/lib/tap.js"></script>
        <script src="/js/init.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="head">
            <a link="/" class="nav_item">
                <img id="logo" src="/img/avatar_asbjornenge.jpeg"/>
            </a>
            <div id="label">Web, Words & Coffee</div>
            <ul id="menu">
                <li class="about nav_item" link="/about.html">About</li>
                <li class="separator">:</li>
                <!--
                <li class="crly nav_item" link="/crly.html">Crly</li>
                <li class="separator">:</li>
                -->
                <li class="software nav_item" link="/software.html">Software</li>
                <li class="separator">:</li>
                <li class="blog nav_item" link="/">Blog</li>
            </ul>
            <span class="nav_selector">&nbsp;</span>
        </div>
        <div style="clear:both"></div>
        <div id="content">
            <h1>JSON Schema Validation</h1>

<p>Your probably pulling &amp; pushing data to and from a JSON RESTful api, right?<br>
If you care about making a great application, you need to care about error handling. Both on the client and the server side. Handling timeouts and dead API&#39;s is easy enough, but handling corrupt data can be tricky. Protecting against corrupt data usually leaves an ugly footprint in your code. Lot&#39;s of <strong>if</strong>&#39;s and <strong>hasOwnProperty</strong>&#39;s. Instead, using <a href="http://json-schema.org">json-schema</a>, you can validate your JSON data first and be sure it is as expected.</p>

<h2>JSON-Schema</h2>

<blockquote>
<p>A JSON Media Type for Describing the Structure and Meaning of JSON Documents</p>
</blockquote>

<p>Example; If you have some simple JSON Data:</p>

<pre><code>{
    &quot;title&quot; : &quot;Kapsokisio&quot;
}
</code></pre>

<p>You can define a corresponding JSON Schema:</p>

<pre><code>{
    &quot;type&quot; : &quot;object&quot;,
    &quot;required&quot; : [&quot;title&quot;]
    &quot;properties&quot; : {
        &quot;title&quot; : { &quot;type&quot; : &quot;string&quot; } 
    }
}
</code></pre>

<p>You can validate your data using that schema. If it is valid, you can be sure the data is an object with a title property of type string.</p>

<h3>Specification</h3>

<p>The latest <a href="http://www.ieft.org">IETF</a> draft is currently <a href="http://tools.ietf.org/html/draft-zyp-json-schema-03">v3</a>, but they have a v4 &quot;<em>…being prepared for submission in early 2013</em>&quot;. This post will focus on <strong>v4</strong>.</p>

<h3>Software</h3>

<p>There is a variety of <a href="http://json-schema.org/implementations.html">implementations</a> available. Since I choose to focus on v4 and since I&#39;m a webnerd, I&#39;ll be using the <a href="https://github.com/geraintluff/tv4">tv4</a> validator for the examples.</p>

<h2>Usage</h2>

<p><strong>NB!</strong> This article is in no way a usage reference!!<br>
It&#39;s more a collection of the things I stubled across trying to figure out how this JSON-Schema thing works. Some important bits, and some of the things I found really useful. See the <a href="#further">further reading</a> section for links to more possibilites and options.</p>

<h3><em>type</em></h3>

<p>Type defines the datatype required for the current object. The value can be a string or an array. Available values are; <strong>object, array, string, boolean, number, null</strong>. The following requires the data to be either an object or a string.</p>

<pre><code>{
    &quot;type&quot; : [&quot;object&quot;,&quot;string&quot;]
}

tv4.validate({}, schema) =&gt; true
tv4.validate([], schema) =&gt; false
</code></pre>

<h3><em>enum</em></h3>

<p>Enum can be an array with elements of any type. Data must be equal to one of the elements to validate.</p>

<pre><code>{
    &quot;enum&quot; : [[1,true,0], {}, 28, 34, &quot;Burbon&quot;]
}
</code></pre>

<h3><em>required</em> [object]</h3>

<p>Required is an array of required properties. It implicitly requires the type object. It needs to be an array of strings.</p>

<pre><code>{
    &quot;required&quot; : [&quot;title&quot;,&quot;origin&quot;,&quot;variety&quot;,&quot;process&quot;]
}
</code></pre>

<h3><em>properties</em> [object]</h3>

<p>Properties provide a way to further specify an objects properties. It is an object where each value is a separate schema.</p>

<pre><code>{
    &quot;propeties&quot; : {
        &quot;title&quot;   : { &quot;type&quot; : &quot;string&quot; },
        &quot;origin&quot;  : { &quot;type&quot; : &quot;string&quot; },
        &quot;variety&quot; : { &quot;enum&quot; : [28,34,&quot;Burbon&quot;] }
    }
}
</code></pre>

<h3><em>items</em> [array]</h3>

<p>Items define the items in an array. It can be a single schema or an array of schemas. The following requires the elements in this array to be a string or an object.</p>

<pre><code>{
    items : [
        { &quot;type&quot; : &quot;string&quot; },
        { &quot;type&quot; : &quot;object&quot; }
    ]
}
</code></pre>

<h3><em>pattern</em> [string]</h3>

<p>Pattern allows you to validate using regular expressions.</p>

<pre><code>{
    &quot;properties&quot; : {
        &quot;url&quot; : { &quot;type&quot; : &quot;string&quot;, &quot;pattern&quot; : /(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;amp;:\/~+#-]*[\w@?^=%&amp;amp;\/~+#-])?/ }
    }
}
</code></pre>

<h3><em>$ref</em></h3>

<p>This is a way of referencing other schemas. It requires a URI or an # for self referencing.</p>

<pre><code>{
    &quot;properties&quot; : {
        &quot;beans&quot; : {
            &quot;type&quot;  : &quot;array&quot;,
            &quot;items&quot; : { &quot;$ref&quot; : &quot;#/definitions/bean&quot;}
        }
    }
}
</code></pre>

<h3><em>oneOf</em></h3>

<h3>Use <em>definitions</em></h3>

<h3>More…</h3>

<p><em>numerics</em>, string <em>minLength</em> <em>maxLength</em></p>

<h2><a id="further"></a>Furter reading</h2>

<h2>Missing</h2>

<p>I would like to see better dependency handling.</p>

<h2>Pros</h2>

<ul>
<li>Cleaner code</li>
<li>Better maintainability</li>
<li>Better apps</li>
</ul>

<h2>Complex example</h2>

<pre><code>{
    &quot;title&quot;   : &quot;Kapsokisio&quot;,
    &quot;origin&quot;  : &quot;Kenya&quot;,
    &quot;variety&quot; : [SL28,SL34],
    &quot;process&quot; : WASHED,
    &quot;weight&quot;  : { 
        &quot;amount&quot; : 350, 
        &quot;unit&quot;   : &quot;g&quot; 
    },
    &quot;roast&quot;   : &quot;light&quot;,
    &quot;roasted&quot; : &lt;date&gt;
}
</code></pre>

            <div class="push"></div>
        </div>
        <div id="footer">enjoy.</div>
    </body>
</html>
