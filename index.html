<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Web, Words & Coffee</title>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

        <link rel="stylesheet" href="/css/reset.css">
        <link rel="stylesheet" href="/css/fonts.css">
        <link rel="stylesheet" href="/css/asbjornenge.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/animate.min.css">
        <link rel="shortcut icon" href="https://www.gravatar.com/avatar/198a385bacf129e4b07f2b9e748787df?s=128">
        <!--
        <link rel="stylesheet" href="/css/highlight/googlecode.css">
        <script src="/js/lib/highlight.pack.js"></script>
        -->
        <script src="/js/lib/ga.js"></script>
        <script src="/js/lib/jquery-1.9.0.min.js"></script>
        <script src="/js/lib/tap.js"></script>
        <script src="/js/init.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="head">
            <a link="/" class="nav_item">
                <img id="logo" src="https://www.gravatar.com/avatar/198a385bacf129e4b07f2b9e748787df?s=80"/>
            </a>
            <div id="label">Web, Words & Coffee</div>
            <ul id="menu">
                <li class="about nav_item" link="/about.html">About</li>
                <li class="separator">:</li>
                <!--
                <li class="crly nav_item" link="/crly.html">Crly</li>
                <li class="separator">:</li>
                -->
                <!--
                <li class="software nav_item" link="/software.html">Software</li>
                <li class="separator">:</li>
                -->
                <li class="blog nav_item" link="/">Blog</li>
            </ul>
            <span class="nav_selector">&nbsp;</span>
        </div>
        <div style="clear:both"></div>
        <div id="social">
            <div class="github"><a href="http://github.com/asbjornenge"><i class="icon-github"></i></a></div>
            <div class="twitter"><a href="http://twitter.com/asbjornenge"><i class="icon-twitter"></i></a></div>
            <div class="itunes"><a href="https://itunes.apple.com/us/artist/asbjorn-enge/id528981222"><i class="icon-music"></i></a></div>
        </div>
        <div id="feed">
            <div class="rss"><a href="http://www.asbjornenge.com/wwc/rss.xml"><i class="icon-rss"></i></a></div>
        </div>
        <div id="content">
            
	
		
    <div id="342e195d">
    	<h1><a href="/wwc/vagrant_skydocking.html">Vagrant skydocking</a></h1>

<div class="date">29.01.2014</div>

<p><em>UPDATED 30.01.2014</em> - Using a <strong>route</strong> instead of <strong>linking</strong> interfaces. A bit simpler. Original <a href="/wwc/vagrant_skydocking_link.html">here</a>.</p>

<h2>A bridge over vagrant water</h2>

<p>I&#39;ve been working quite a bit with <a href="http://docker.io">docker</a> lately. If you haven&#39;t yet checked it out, it&#39;s about time. Docker is already popping paradigms.</p>

<p>Since I&#39;m on OSX I&#39;m running my docker host on Virtualbox via <a href="http://www.vagrantup.com/">Vagrant</a>.</p>

<p>Instead of having to forward ports and using lots of -p args when spawning containers, I wanted to bridge my host and the vm&#39;s docker interface, so that I could ping my containers from my OSX terminal.</p>

<p>Create a <strong>private_network</strong> in your Vagrantfile. I&#39;m picking an ip on a different subnet than the docker0 interface to avoid any potential conflicts.</p>

<pre><code>Vagrant::VERSION &gt;= &quot;1.1.0&quot; and Vagrant.configure(&quot;2&quot;) do |config|
    config.vm.network &quot;private_network&quot;, ip: &quot;10.2.0.10&quot;, netmask: &quot;255.255.0.0&quot;
    config.vm.provider :virtualbox do |vb|
        vb.customize [&quot;modifyvm&quot;, :id, &quot;--nicpromisc2&quot;, &quot;allow-all&quot;]
    end
end
</code></pre>

<p>The <em>vb.customize</em> is to allow forwarding packets for the bridge interface. The <em>--nicpromisc2</em> translates to <em>Promiscuous mode for nic2</em>, where nic2 -&gt; eth1. So --nocpromisc3 would change that setting for eth2, etc.</p>

<p>After reloading vagrant we need create a <strong>route</strong> on the host. Basically, any traffic trying to reach the docker subnet (172.17.0.0) should be routed to our new interface inside the vm (10.2.0.10).</p>

<pre><code># OSX
sudo route -n add -net 172.17.0.0 10.2.0.10
# Linux (untested)
sudo route -net 172.17.0.0 netmask 255.255.0.0 gw 10.2.0.10
</code></pre>

<p>You now have a <strong>bridge</strong> from your host to your docker network!!</p>

<pre><code>$&gt; IP=`docker inspect -format=&#39;{{.NetworkSettings.IPAddress}}&#39; skydns`
$&gt; ping $IP
PING 172.17.0.3 (172.17.0.3) 56(84) bytes of data.
64 bytes from 172.17.0.3: icmp_req=1 ttl=64 time=0.232 ms
64 bytes from 172.17.0.3: icmp_req=2 ttl=64 time=0.103 ms
^C
--- 172.17.0.3 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1009ms
rtt min/avg/max/mdev = 0.103/0.167/0.232/0.065 ms
</code></pre>

<p><img src="https://raw2.github.com/jglovier/gifs/gh-pages/aha/aha.gif" alt="AHA"></p>

<h2>Skydock</h2>

<p>Docker is all about distributed systems; packing single components inside containers and have them talk to eachother. One of the painpoints when shattering your monolith is linking all those loose components together.</p>

<p>(Docker provides a -link parameter for linking containers. But this quickly falls short in complex scenarios.)</p>

<p>I was just about to dig into service discrovery solutions like <a href="https://github.com/coreos/etcd">etcd</a> or similar, when <a href="http://crosbymichael.com/">Michael Crosby</a> posted his <a href="https://github.com/crosbymichael/skydock">skydock</a> (<a href="https://www.youtube.com/watch?v=Nw42q1ofrV0">video</a>). It&#39;s brilliant! It let&#39;s you discover your service via <strong>DNS</strong>. I won&#39;t go into setting up skydock, just check out the awesome <a href="https://github.com/crosbymichael/skydock">tutorial</a> by Michael.</p>

<p>So, with skydock my containers can discover eachother via DNS names like <strong>myservice.env.domain.com</strong>. Awesome! But, with my network bridge set up, so can my host!! No? That would be really nice for development...</p>

<pre><code>$&gt; curl elasticsearch.dev.domain.com:9200
curl: (6) Could not resolve host: elasticsearch.dev.domain.com
</code></pre>

<p>﴾͡๏̯͡๏﴿ ... Ah, we need to hook up skydns as a nameserver. This is where I stray a little from Michael&#39;s skydock tutorial. I had some issues binding to the docker0 interface (docker v0.7.6), so instead I&#39;m using the skydns container as the nameserver directly (PS! this requires passing a -dns <skydns_ip> arg to each new container). Either way, we have to edit resolv.conf.</p>

<pre><code>$&gt; sudo vi /etc/resolv.conf
   # nameserver 172.17.42.1 &lt;- skydock tutorial
   nameserver 172.17.0.3 # &lt;- skydns container ip
$&gt; dig elasticsearch.dev.domain.com
;; ANSWER SECTION:
elasticsearch.dev.domain.com.   20  IN  A   172.17.0.7
</code></pre>

<p>✌(-‿-)✌ ... Hoplah! Now, hopefully that will be it for you and you&#39;re all set to curl containers from the comforts of your host terminal! I however, had one more issue to solve...</p>

<pre><code>$&gt; curl elasticsearch.dev.domain.com:9200
curl: (6) Could not resolve host: elasticsearch.dev.domain.com # w00000000t???
</code></pre>

<h3>OSX weirdness</h3>

<p>Apparently OSX is rather weird in how it handles DNS. <strong>dig</strong>, <strong>host</strong>, etc. can resolve the host just fine, but other tools like <strong>curl</strong> and even <strong>ping</strong> does not obey resolv.conf. I eventually stumbled across the issue and found <a href="https://github.com/michthom/AlwaysAppendSearchDomains">this</a> script that apparently solves it for most people. It didn&#39;t help. Eventually I added the DNS server via OSX <a href="http://support.apple.com/kb/PH14159">network preferences</a>, and that did the trick.</p>

<pre><code>$&gt; curl elasticsearch.dev.domain.com:9200
{
    &quot;ok&quot; : true,
    &quot;status&quot; : 200,
    &quot;name&quot; : &quot;Damian, Margo&quot;,
    &quot;version&quot; : {
        &quot;number&quot; : &quot;1.0.0.Beta2&quot;,
        &quot;build_hash&quot; : &quot;296cfbe390dc51bb00c00ba48ad0c8a9efabcfe9&quot;,
        &quot;build_timestamp&quot; : &quot;2013-12-02T15:46:27Z&quot;,
        &quot;build_snapshot&quot; : false,
        &quot;lucene_version&quot; : &quot;4.6&quot;
    },
    &quot;tagline&quot; : &quot;You Know, for Search&quot;
}
</code></pre>

<p><img src="http://i0.kym-cdn.com/profiles/icons/big/000/055/347/1313845263510.gif" alt="HAPPY"></p>

<p>I&#39;m now a ᕙ༼ຈل͜ຈ༽ᕗ curl’er of containers!!</p>

<h2>Credits</h2>

<p><a href="http://docker.io">Docker</a>, <a href="https://github.com/crosbymichael/skydock">Skydock</a> and <a href="https://github.com/skynetservices/skydns">Skydns</a> all deserve a big fat ♥.<br>
I followed <a href="https://blog.codecentric.de/en/2014/01/docker-networking-made-simple-3-ways-connect-lxc-containers/">this</a> guide by <a href="https://twitter.com/drivebytesting">Lukas Pustina</a> to set up my vagrant networking.<br>
Gifs from <a href="https://github.com/jglovier/gifs">here</a> and faces from <a href="https://github.com/maxogden/cool-ascii-faces">there</a>.<br>
Thanks!</p>

    </div>

		
    <div id="b6a35118">
    	<h1><a href="/wwc/out_of_sorts.html">Out of sorts</a></h1>

<div class="date">30.03.2013</div>

<blockquote>
<p>My first real fight with fonts.</p>
</blockquote>

<h4>Disclaimer</h4>

<p>Before I even start this I should probably state that this adventure leads into unfamiliar terrain, and over half my findings are probably half-witted nonsense. There. I should probably start all my blogposts like that.</p>

<h2>Introduction</h2>

<p>Fonts are important. Most of what we see on our screens is text in some form, or typeface, to dive right into the syntax. </p>

<p>Starting out on my current font adventure I was quite shocked by how little I knew about the font world. I had been developing websites and apps full of text for years, but hardly knew what a baseline was. To some extent that is a good thing, it had just worked. On the other hand, it is a level of control over my design I had been completely ingorant about.</p>

<h2>The design bullet</h2>

<p>The current problem I was facing seemed simple enough; allow a line of text to include a bullet. Easy as pie.</p>

<pre><code>&lt;span style=&quot;display:list-item&quot;&gt;Some Text&lt;/span&gt;
</code></pre>

<p>Turned out it wasn&#39;t quite so easy. These bullets were part of our clients design manual, but they were not the same as the bullet glyph of the font. Modifying the font was also out of the question because of licensing.</p>

<p>But, there was a clear definition; the bullet was a square of <em>height</em> and <em>width</em> <em>x</em> relative the <em>font-size</em>, <strong>vertically aligned</strong> (centered) with the fonts <a href="http://en.wikipedia.org/wiki/Baseline_(typography)"><strong>x-height</strong></a>.</p>

<p>Calculating the x-height of a target element is easy enough using css&#39;s <a href="http://www.w3.org/Style/Examples/007/units#units"><strong>ex</strong></a> unit.</p>

<pre><code>$(&#39;&lt;div style=&quot;width:1ex&quot;&gt;&lt;/div&gt;&#39;).appendTo(target)[0].offsetWidth
</code></pre>

<p>But the x-height itself was of little use. To vertically align my bullet with the x-height, I needed to know the margin, bottom or top, of the <strong>baseline</strong> or <strong>median</strong>; I needed more metrics.</p>

<p>Alright, easy enough. Let&#39;s see… <em>&quot;javascript font metrics&quot;</em>. Uhm…  </p>

<h4>The bad news</h4>

<p>There is no built-in, easy, standard way of extracting the metrics of a font.  </p>

<h4>The good news</h4>

<p>It&#39;s possible to calculate! AND, there is a great <a href="https://github.com/Pomax/Font.js">library</a> that will do most of the heavy lifting for you! We&#39;ll get to that.</p>

<h2>Calculation</h2>

<p>To calculate a fonts vertical metrics, there are two approaches as far as I can tell.</p>

<p><strong>1. Measuring dom elements</strong></p>

<p>The first <a href="http://www.brunildo.org/test/xheight.pl">approach</a> is to use a bunch of dom elements with specific font-related metrics (1em, 1ex, etc.) and measure these in px (offsetWidth) at different levels and at different font-size&#39;s.</p>

<p>The approach seems to work quite well for the calculation part. Sturdy across browsers and fonts. For the actual positioning there were other icebergs floating around.</p>

<p>NB! The solution is a possible performance drain if used unwisely - measuring offsetWidth might cause unwanted reflow (repaint of your dom elements).</p>

<p><strong>2. Canvas</strong></p>

<p>The second <a href="http://processingjs.nihongoresources.com/FontMetrics/">approach</a> is using the canvas element. The 2d context of a canvas has <em>font</em>, <em>fillText</em> and <em>measureText</em> functions. Unfortunately <a href="http://www.w3.org/TR/2012/WD-2dcontext-20120329/#dom-context-2d-measuretext"><em>measureText</em></a> only deals with the <a href="http://www.w3.org/TR/2012/WD-2dcontext-20120329/#textmetrics">width</a> metric, but that seems to be about to <a href="http://www.w3.org/TR/2dcontext/#textmetrics">change</a> (!!). For now though, the approach is to dump and analyze the raw pixel data and figure out how many pixels are used vertically to draw different letters of the font.</p>

<p>This approach also works perfectly for the calculation part, and thanks to the awesome <a href="http://processingjs.nihongoresources.com/FontMetrics/fontmetrics.js">fontmetrics.js</a> it&#39;s easy.  </p>

<p>But again, for the actual positioning, I was soon stuck in a pitch black room (next to a tiny, grey, startling little cat with diarrhea. Sitting on a matressless, iron-sprung bed with its huge eyes mewing at me. Meow. Smoking as well, probably. And then some terrible guy the colour of an aubergine round the corner holding a mug of beef tea and wearing a string vest going “meew. Fuckn brrr aaah” ~ Dylan Moran).</p>

<h2>@font-face</h2>

<p>The days of web typography is upon us. We are no longer limited to a handful of built-in fonts. Using technologies like <a href="http://sixrevisions.com/css/font-face-guide/">@font-face</a> we can embed &quot;any&quot; font on our page and have it render &quot;beautifully&quot; on the client&#39;s browser.</p>

<p>There are however quite a few <a href="http://www.fontsquirrel.com/blog/2010/11/troubleshooting-font-face-problems">pitfalls</a> &amp; <a href="http://www.owlfolio.org/htmletc/legibility-of-embedded-web-fonts/">legibility</a> issues.</p>

<h3>Rendering</h3>

<p>The one that hit me hard in the face is the fact that different browsers, and even the same browsers on different operating systems, deal very differently with how they render fonts. Even different versions of the same operating system will sometimes render fonts very differently.</p>

<p><em>At typical body-text sizes, the computer has to draw each letter using only 15 or so pixels in each direction. It’s not possible to draw each letter exactly as the typographer intended, and keep all the lines crisp and smooth, with that few pixels. Windows, OSX, and Linux all resolve this dilemma differently: to oversimplify a bit, OSX tries harder to preserve the font shapes, Windows tries harder to make the lines sharp, and Linux tries to do both at once and winds up achieving neither.<br>
~ Zachary Weinberg</em></p>

<p>Sometimes the font won&#39;t even render inside it&#39;s bounding box! (!!!!) For my current problem, that makes any font metric calculation futile. Turns out, this library I&#39;ve been mumbling about had a solution for even this.</p>

<h3>Timing</h3>

<p>Another issue with embedded fonts is knowing when the font is loaded. If you try to measure prematurely you will end up measuring the fallback font, and thats no good. </p>

<p>The only viable solution I have come across is using a &quot;dummy&quot; fallback font that will encode a character as a zero-width unit. Putting that in a paragraph and polling for a real width. It&#39;s not a great solution but it works.</p>

<h2>Font.js</h2>

<p>Fortunately someone has already thread this path for us.<br>
<a href="http://pomax.nihongoresources.com/pages/Font.js/">Font.js</a> adds a <strong>Font</strong> object to your javascript toolbelt. It&#39;s designed to behave similar to the <strong>Image</strong> object.</p>

<pre><code>var font = new Font();
font.onload  = function() {}
font.onerror = function() {}
font.src = &quot;http://your.domain.com/fonts/font.otf&quot;
</code></pre>

<p>It handles <strong>timing</strong> issue using the detailed solution above, and will call your <em>onload</em> function when the font is available. It gives you <strong>metrics</strong>.</p>

<pre><code>font.metrics -&gt; {}
font.measureText(string, size) -&gt; {}
</code></pre>

<p>They even handle the <strong>rendering</strong> issue (to some extent).</p>

<p><em>Font.js actually draws text offscreen, does a scanline pass to find out what the &quot;real&quot; ascent and descent is, and then sets height to ascent + 1 + descent (&quot;1&quot; for the baseline itself). This generally works quite well, but will lead to incorrect heights for fonts that don&#39;t implement the Latin blocks =)<br>
~ Michiel Kamermans</em></p>

<p>One important thing to note is that the fonts are loaded using <strong>XMLHttpRequest</strong>&#39;s. This is important since it is the only way to get the font data so it can be inspected and manipulated. But it does mean you have to deal with hosting your own fonts or setting up <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> to avoid <em>Access-Control-Allow-Origin</em> issues. </p>

<p>Font.js is a great library for solving most of the current headaches related to fonts.</p>

<p>Grab it from the github <a href="https://github.com/Pomax/Font.js">repo</a> or via <a href="http://twitter.github.com/bower/">bower</a>.</p>

<pre><code>bower install Font.js
</code></pre>

<h2>Resources</h2>

<p><a href="http://pomax.nihongoresources.com/pages/Font.js/">http://pomax.nihongoresources.com/pages/Font.js/</a><br>
<a href="http://www.brunildo.org/test/xheight.pl">http://www.brunildo.org/test/xheight.pl</a><br>
<a href="http://www.icavia.com/2010/09/solving-font-face-alignment-issues/">http://www.icavia.com/2010/09/solving-font-face-alignment-issues/</a><br>
<a href="http://mudcu.be/journal/2011/01/html5-typographic-metrics/">http://mudcu.be/journal/2011/01/html5-typographic-metrics/</a><br>
<a href="http://www.owlfolio.org/htmletc/legibility-of-embedded-web-fonts/">http://www.owlfolio.org/htmletc/legibility-of-embedded-web-fonts/</a><br>
<a href="http://en.wikipedia.org/wiki/Baseline_(typography)">http://en.wikipedia.org/wiki/Baseline_(typography)</a><br>
<a href="http://stackoverflow.com/questions/1134586/how-can-you-find-the-height-of-text-on-an-html-canvas">http://stackoverflow.com/questions/1134586/how-can-you-find-the-height-of-text-on-an-html-canvas</a>  </p>

    </div>

		
    <div id="98c6d461">
    	<h1><a href="/wwc/zero_todo.html">Zero Todo</a></h1>

<div class="date">08.03.2013</div>

<blockquote>
<p>Todo workflow for inbox zeroists.</p>
</blockquote>

<p>I&#39;m an <a href="http://inboxzero.com/">inbox zeroist</a>; my inbox is my todo list.</p>

<p>For us (well, for me at least) todo applications quikly get neglected. I love their shiny UI&#39;s and impressive and thought out UX, but the fact remains that the tasks I so optimistically punch in never get done. I&#39;ve tried numerous approaches. My read-later services are filled to the brim by awesomeness that will never get parsed by anyone but <a href="https://twitter.com/marcoarment">@marcoarment</a>&#39;s robots.</p>

<p>I always return to my inbox, so whatever gets in there gets action.</p>

<p>The following is an attempt to simplify adding &quot;tasks&quot; to my inbox.</p>

<h2>Postfix</h2>

<p>Get your local postfix relaying to a proper smtp server. I followed <a href="http://www.garron.me/mac/postfix-relay-gmail-mac-os-x-local-smtp.html">this guide</a> for gmail. Be sure to also add the following to <em>/etc/postfix/main.cf</em>.</p>

<pre><code>smtp_sasl_security_options = noanonymous
</code></pre>

<h2>$ mail</h2>

<p>Now you can send emails from your shell.</p>

<pre><code>df -h | mail -s &quot;Disk usage&quot; you@domain.io
</code></pre>

<h2>Hotkey</h2>

<p>There are multiple ways to have a hotkey execute a script. I choose Alfred because I like Alfred and because it has support for passing any selected text as an argument to the script.</p>

<p>Add your extension. It might be a good idea to click <em>Advanced</em> and configure escaping. Mail seems to handle all these chars nicely, so I just unchecked it all.</p>

<p><img width="500px" src="../img/wwc/zero_todo/screenshot1.png"/></p>

<p>Add a hotkey for that extension and check &quot;Selected text in OS X&quot;.</p>

<p><img width="500px" src="../img/wwc/zero_todo/screenshot2.png"/></p>

<p>An thats it, you can now select any text in osx and stack it on top of your inbox by pressing your specified hotkey.</p>

    </div>

		
    <div id="68fef665">
    	<h1><a href="/wwc/json_schema.html">JSON Schema Validation</a></h1>

<div class="date">10.02.2013</div>

<p>Your probably talking JSON with a RESTful api, right?<br>
If you care about creating a great experience, you need to take error handling seriously. Handling timeouts and http error codes is pretty straight forward, but handling corrupt data can be tricky. It often leaves an ugly footprint in your code. Lot&#39;s of <strong>if</strong>&#39;s and <strong>hasOwnProperty</strong>&#39;s. Instead, using <a href="http://json-schema.org">json-schema</a>, you can validate your JSON data first and be sure it is as expected.</p>

<h2>JSON-Schema</h2>

<blockquote>
<p>A JSON Media Type for Describing the Structure and Meaning of JSON Documents</p>
</blockquote>

<p>Example; If you have some JSON Data:</p>

<pre><code>{
    &quot;title&quot; : &quot;Kapsokisio&quot;
}
</code></pre>

<p>You can define a corresponding JSON Schema:</p>

<pre><code>{
    &quot;type&quot; : &quot;object&quot;,
    &quot;required&quot; : [&quot;title&quot;],
    &quot;properties&quot; : {
        &quot;title&quot; : { &quot;type&quot; : &quot;string&quot; } 
    }
}
</code></pre>

<p>You can validate your data using that schema. If it is valid, you can be sure this data is an object with a title property of type string.</p>

<h3><a id="specification"></a> Specification</h3>

<p>The latest <a href="http://www.ieft.org">IETF</a> draft is currently <a href="http://tools.ietf.org/html/draft-zyp-json-schema-03">v3</a>, but they have a v4 <em>being prepared for submission in early 2013</em>. <strong>This post will focus on v4</strong>.</p>

<p><strong>UPDATE</strong><br>
The new drafts are up!</p>

<p><strong>Core:</strong><br>
<a href="http://tools.ietf.org/html/draft-zyp-json-schema-04">http://tools.ietf.org/html/draft-zyp-json-schema-04</a><br>
<strong>Validation:</strong><br>
<a href="http://tools.ietf.org/html/draft-fge-json-schema-validation-00">http://tools.ietf.org/html/draft-fge-json-schema-validation-00</a></p>

<h3>Software</h3>

<p>There is a variety of <a href="http://json-schema.org/implementations.html">implementations</a> available. Since I choose to focus on v4 and since I&#39;m a webnerd, <strong>I&#39;ll be using the <a href="https://github.com/geraintluff/tv4">tv4</a> validator for the examples</strong>.</p>

<h2>Usage</h2>

<p><strong>NB!</strong> This article is in no way a usage reference!!<br>
It&#39;s more a collection of the things I stubled across trying to figure out how this JSON-Schema thing works. Some important bits, and some of the things I found really useful. See the <a href="#further">further reading</a> section for more possibilites and options.</p>

<h3><em>type</em></h3>

<p>Using &quot;type&quot; you can specify the datatype required for the current object. The value can be a string or an array. Available values are; <strong>object, array, string, boolean, integer, number, null</strong>. The following requires the data to be either an object or a string.</p>

<pre><code>{
    &quot;type&quot; : [&quot;object&quot;,&quot;string&quot;]
}

tv4.validate({}, schema) // true
tv4.validate([], schema) // false
</code></pre>

<h3><em>enum</em></h3>

<p>Using &quot;enum&quot; you can define an array with elements of any type. Data must be equal to one of the elements to validate.</p>

<pre><code>{
    &quot;enum&quot; : [[1,true,0], {}, 28, &quot;Burbon&quot;]
}

tv4.validate([1,true,0], schema) // true
tv4.validate(34, schema) // false
</code></pre>

<h3><em>required</em></h3>

<p>Using &quot;required&quot; you can define an array of required properties. It&#39;s value is an array of strings.</p>

<pre><code>{
    &quot;required&quot; : [&quot;title&quot;,&quot;origin&quot;]
}

tv4.validate({&quot;title&quot; : &quot;&quot;, &quot;origin&quot; : &quot;&quot;}, schema) // true
tv4.validate({&quot;title&quot; : &quot;&quot;}, schema) // false
</code></pre>

<h3><em>properties</em></h3>

<p>Using &quot;properties&quot; you can further specify an objects properties. It is an object where each value is a separate schema.</p>

<pre><code>{
    &quot;properties&quot; : {
        &quot;title&quot;   : { &quot;type&quot; : &quot;string&quot; },
        &quot;weight&quot;  : { &quot;type&quot; : &quot;number&quot; }
    }
}

tv4.validate({&quot;title&quot; : &quot;&quot;, &quot;weight&quot; : 2}, schema) // true
tv4.validate({&quot;title&quot; : &quot;&quot;, &quot;weight&quot; : &quot;2&quot;}, schema) // false
</code></pre>

<h3><em>items</em></h3>

<p>Using &quot;items&quot; you can specify the requirements for the items in an array. It can be a single schema or an array of schemas. The following requires the elements in this array to be a string or an object.</p>

<pre><code>{
    items : [
        { &quot;type&quot; : &quot;string&quot; },
        { &quot;type&quot; : &quot;object&quot; }
    ]
}

tv4.validate([&quot;&quot;,{}], schema) // true
tv4.validate([&quot;&quot;,true], schema) // false
</code></pre>

<h3><em>pattern</em></h3>

<p>Using &quot;pattern&quot; you can validate using regular expressions. Powerful stuff!</p>

<pre><code>{
    &quot;properties&quot; : {
        &quot;url&quot; : { &quot;type&quot; : &quot;string&quot;, &quot;pattern&quot; : /(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;amp;:\/~+#-]*[\w@?^=%&amp;amp;\/~+#-])?/ }
    }
}

tv4.validate({&quot;url&quot; : &quot;http://google.com&quot;}, schema) // true
tv4.validate({&quot;url&quot; : &quot;htt:/googleco.m&quot;}, schema) // false
</code></pre>

<h3><em>$ref</em></h3>

<p>Using &quot;$ref&quot; you can reference other schemas. You can use a URI or an # for internal referencing. Using <em>definitions</em> as a location for your internal referenced schemas is not a rule but a common practice.</p>

<pre><code>{
    &quot;items&quot; : { 
        &quot;$ref&quot; : &quot;#/definitions/bean&quot;
    },
    &quot;definitions&quot; : {
        &quot;bean&quot; : {
            &quot;type&quot; : &quot;object&quot;,
            &quot;required&quot; : [&quot;origin&quot;],
            &quot;properties&quot; : {
                &quot;origin&quot; : { &quot;enum&quot; : [&quot;kenya&quot;,&quot;rawanda&quot;] }
            }
        }
    }
}

tv4.validate([{&quot;origin&quot; : &quot;kenya&quot;}], schema) // true
tv4.validate([{&quot;origin&quot; : &quot;brazil&quot;}], schema) // false
tv4.validate([&quot;kenya&quot;,&quot;rawanda&quot;], schema) // false
</code></pre>

<h3><em>allOf</em></h3>

<p>Using &quot;allOf&quot; you can define an array of schemas where your data elements must validate against all of them.</p>

<pre><code>{
    &quot;allOf&quot; : [
        { &quot;type&quot; : &quot;integer&quot; },
        { &quot;minimum&quot; : 6 }
    ]
}

tv4.validate(6, schema) // true
tv4.validate(5, schema) // false
</code></pre>

<h3><em>oneOf</em></h3>

<p>Using &quot;oneOf&quot; you can define an array of schemas where your data elements must validate against one (and only one) of them.</p>

<pre><code>{
    &quot;oneOf&quot; : [
        { &quot;type&quot;    : &quot;integer&quot; },
        { &quot;minimum&quot; : 6 }
    ]
}

tv4.validate(5, schema) // true
tv4.validate(6, schema) // false
</code></pre>

<h3><em>anyOf</em></h3>

<p>Using &quot;anyOf&quot; you can define an array of schemas where your data elements can validate against any (at least one) of them.</p>

<pre><code>{
    &quot;anyOf&quot; : [
        { &quot;type&quot;    : &quot;integer&quot;  },
        { &quot;minimum&quot; : 6 }
    ]
}

tv4.validate(5, schema) // true
tv4.validate(6, schema) // true
</code></pre>

<h3><em>not</em></h3>

<p>Using &quot;not&quot; you can define a schema your data elements should to not validate against.</p>

<pre><code>{
    &quot;not&quot; : { &quot;type&quot; : &quot;string&quot; }
}

tv4.validate(1, schema) // true
tv4.validate(&quot;test&quot;, schema) // false
</code></pre>

<h3>Error handling</h3>

<p><strong>(tv4 specific)</strong></p>

<p>I just thought I&#39;d quickly mention how tv4 handles a failure:</p>

<pre><code>tv4.validate([],{&quot;type&quot; : &quot;object&quot;})
var err = tv4.error
while(err != null) {
    console.log(err.message, err.schemaPath, err.dataPath)
    err = err.subErrors
}
</code></pre>

<h2><a id="further"></a>Further reading</h2>

<p>I would really recommend reading through the <a href="https://github.com/geraintluff/tv4/tree/master/tests/tests">tests for tv4</a>, they provide excellent usage examples for the different possibilites. On the JSON-Schema <a href="http://json-schema.org/">website</a> you will find the <a href="http://json-schema.org/documentation.html">documentation</a> and some great <a href="http://json-schema.org/example2.html">examples</a>.</p>

<h2>Pros</h2>

<p>One of the biggest benefits of using JSON-Schema validation is that it will allow you a cleaner codebase. You can trust your data. That in turn improves readability and maintainability which leads to better and more robust applications. In the end; a better user experience.</p>

<h2>Cons</h2>

<p>It can be quite tedious building a good schema describing your data. And of course, if you change your data structures, you need to update your schema (in addition to your code). But considering how this approach will simplify your codebase, I would definately say it&#39;s well worth it.</p>

<h1>Real world example</h1>

<p><strong>Data</strong></p>

<pre><code>{
    &quot;title&quot;   : &quot;Kapsokisio&quot;,
    &quot;origin&quot;  : &quot;Kenya&quot;,
    &quot;variety&quot; : [&quot;SL28&quot;,&quot;SL34&quot;,&quot;Burbon&quot;],
    &quot;process&quot; : &quot;Washed&quot;,
    &quot;roast&quot; : {
        &quot;level&quot; : 4,
        &quot;date&quot;  : &quot;08.02.2012&quot;
    },
    &quot;bag&quot; : {
        &quot;weight&quot; : 354,
        &quot;date&quot;   : &quot;08.02.2012&quot;
    },
    &quot;brew_tip&quot; : {
        &quot;method&quot; : &quot;pourover&quot;,
        &quot;grind&quot;  : &quot;medium&quot;,
        &quot;vessle&quot; : &quot;chemex&quot;
    }
}
</code></pre>

<p><strong>Schema</strong></p>

<pre><code>{
    &quot;type&quot; : &quot;object&quot;,
    &quot;required&quot; : [&quot;title&quot;,&quot;origin&quot;,&quot;variety&quot;,&quot;process&quot;,&quot;roast&quot;,&quot;bag&quot;],
    &quot;properties&quot; : {
        &quot;title&quot;    : { &quot;type&quot; : &quot;string&quot;  },
        &quot;origin&quot;   : { &quot;type&quot; : &quot;string&quot;  },
        &quot;variety&quot;  : { &quot;type&quot; : &quot;array&quot;   },
        &quot;process&quot;  : { &quot;type&quot; : &quot;string&quot; },
        &quot;bag&quot;      : { &quot;$ref&quot; : &quot;#/definitions/bag&quot; },
        &quot;roast&quot;    : { &quot;$ref&quot; : &quot;#/definitions/roast&quot; },
        &quot;brew_tip&quot; : { &quot;$ref&quot; : &quot;#/definitions/brew_tip&quot; }
    },
    &quot;definitions&quot; : {
        &quot;roast&quot; : {
            &quot;type&quot; : &quot;object&quot;,
            &quot;required&quot; : [&quot;level&quot;, &quot;date&quot;],
            &quot;properties&quot; : {
                &quot;level&quot; : { &quot;type&quot; : &quot;integer&quot; },
                &quot;date&quot;  : { 
                    &quot;type&quot; : &quot;string&quot;, 
                    &quot;pattern&quot; : /^\d{2}([./-])\d{2}\1\d{4}$/
                }
            }
        },
        &quot;bag&quot; : {
            &quot;type&quot; : &quot;object&quot;,
            &quot;required&quot; : [&quot;weight&quot;, &quot;date&quot;],
            &quot;properties&quot; : {
                &quot;weight&quot; : { &quot;type&quot; : &quot;number&quot; },
                &quot;date&quot;   : { 
                    &quot;type&quot; : &quot;string&quot;, 
                    &quot;pattern&quot; : /^\d{2}([./-])\d{2}\1\d{4}$/
                }
            }
        },
        &quot;brew_tip&quot; : {
            &quot;type&quot; : &quot;object&quot;,
            &quot;required&quot; : [&quot;method&quot;,&quot;grind&quot;,&quot;vessle&quot;],
            &quot;properties&quot; : {
                &quot;method&quot; : { &quot;type&quot; : &quot;string&quot; },
                &quot;grind&quot;  : { &quot;type&quot; : &quot;string&quot; },
                &quot;vessel&quot; : { &quot;type&quot; : &quot;string&quot; }
            }
        }
    }
}
</code></pre>

    </div>


            <div class="push"></div>
        </div>
        <div id="footer">enjoy.</div>
    </body>
</html>
